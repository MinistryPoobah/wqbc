punctuate_strings <- function (x, qualifier = "or") {
  if(length(x) == 1)
    return (x)
  n <- length(x)
  paste(paste(x[-n], collapse = ", "), qualifier, x[n])
}

remove_columns_from_x_in_y <- function (x, y) {

  colnames <- colnames(x)[colnames(x) %in% colnames(y)]
  if(length(colnames) >= 1) {
    message("Removed columns ", punctuate_strings(colnames, "and"), " from x")
  }
  x[,!colnames(x) %in% colnames(y), drop = FALSE]
}

## Assign and transform the coordinate system/projection to match the base BC map
proj_bc <- function (data, x, y, input_proj = NULL) {

  if(!requireNamespace("sp", quietly = TRUE))
    stop("sp package not installed")

  if(!requireNamespace("rgdal", quietly = TRUE))
    stop("rgdal package not installed")

  if (is.null(input_proj)) {
    input_proj <- "+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"
  }
  output_proj <- "+proj=aea +lat_1=50 +lat_2=58.5 +lat_0=45 +lon_0=-126 +x_0=1000000 +y_0=0 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"

  sp::coordinates(data) <- c(x,y)
  sp::proj4string(data) <- sp::CRS(input_proj)
  data <- sp::spTransform(data, sp::CRS(output_proj))
  as.data.frame(data)
}

#' Geometric Mean Plus-Minus 1
#'
#' Calculates geometric mean by adding 1 before logging
#' and subtracting 1 before exponentiating so that
#' geometric mean of
#' @param x numeric vector of non-negative numbers
#' @param na.rm flag indicating whether to remove missing values
#' @return number
#' @examples
#' mean(0:9)
#' geomean1(0:9)
#' @export
geomean1 <- function (x, na.rm = FALSE) {
  assert_that(is.numeric(x))
  assert_that(is.flag(na.rm))
  expm1(mean(log1p(x), na.rm = na.rm))
}
